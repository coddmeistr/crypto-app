version: "3.8"

services:
  postgres:
    container_name: postgres_container
    image: postgres:16.0
    environment:
      POSTGRES_DB: "db"
      POSTGRES_USER: "admin"
      POSTGRES_PASSWORD: "root"
      PGDATA: "/var/lib/postgresql/data/pgdata"
    hostname: "postgresdb"
    volumes:
      - forpostgres:/var/lib/postgresql/data
      - .:/docker-entrypoint-initdb.d
    ports:
      - "5432:5432"

  account:
    container_name: account_container
    environment:
      CRYPTO_SERVICE_HOST: "crypto_container:8181"
      DB_CONNECTION_STRING: "postgres://admin:root@postgresdb:5432/db"
    build: ./account
    ports:
      - "8080:8080"
    depends_on:
      - postgres

  crypto:
    container_name: crypto_container
    build: ./crypto
    environment:
      CRYPTO_COMPARE_KEY: 8b0b296373b86403560d64ab9a1e29ae35ab088e87ef5745f554ef5d0a2673be
    ports:
      - "8181:8181"
    depends_on:
      - account
  
  gateway:
    container_name: gateway_container
    environment:
      CRYPTO_SERVICE_HOST: "crypto_container:8181"
      ACCOUNT_SERVICE_HOST: "account_container:8080"
      SECRET_KEY: "sdfsfsD13DFGSFS"
    build: ./gateway
    ports:
      - "80:80"
    depends_on:
      - account
      - crypto

volumes:
  forpostgres:

networks:
  postgres:
    driver: bridge
    